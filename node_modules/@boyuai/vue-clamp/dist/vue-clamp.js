!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).VueClamp=t(e.Vue)}(this,(function(e){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var t=null;var i=null;function n(e,t){void 0===t&&(t={});var i=document.createElement(e);return Object.keys(t).forEach((function(e){i[e]=t[e]})),i}function r(e,t,i){return(window.getComputedStyle(e,i||null)||{display:"none"})[t]}function o(e){if(!document.documentElement.contains(e))return{detached:!0,rendered:!1};for(var t=e;t!==document;){if("none"===r(t,"display"))return{detached:!1,rendered:!1};t=t.parentNode}return{detached:!1,rendered:!0}}var s=0,a=null;function d(e,t){if(e.__resize_mutation_handler__||(e.__resize_mutation_handler__=l.bind(e)),!e.__resize_listeners__)if(e.__resize_listeners__=[],window.ResizeObserver){var i=e.offsetWidth,d=e.offsetHeight,u=new ResizeObserver((function(){(e.__resize_observer_triggered__||(e.__resize_observer_triggered__=!0,e.offsetWidth!==i||e.offsetHeight!==d))&&c(e)})),_=o(e),p=_.detached,g=_.rendered;e.__resize_observer_triggered__=!1===p&&!1===g,e.__resize_observer__=u,u.observe(e)}else if(e.attachEvent&&e.addEventListener)e.__resize_legacy_resize_handler__=function(){c(e)},e.attachEvent("onresize",e.__resize_legacy_resize_handler__),document.addEventListener("DOMSubtreeModified",e.__resize_mutation_handler__);else if(s||(a=function(e){var t=document.createElement("style");return t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),(document.querySelector("head")||document.body).appendChild(t),t}('.resize-triggers{visibility:hidden;opacity:0}.resize-contract-trigger,.resize-contract-trigger:before,.resize-expand-trigger,.resize-triggers{content:"";position:absolute;top:0;left:0;height:100%;width:100%;overflow:hidden}.resize-contract-trigger,.resize-expand-trigger{background:#eee;overflow:auto}.resize-contract-trigger:before{width:200%;height:200%}')),function(e){var t=r(e,"position");t&&"static"!==t||(e.style.position="relative");e.__resize_old_position__=t,e.__resize_last__={};var i=n("div",{className:"resize-triggers"}),o=n("div",{className:"resize-expand-trigger"}),s=n("div"),a=n("div",{className:"resize-contract-trigger"});o.appendChild(s),i.appendChild(o),i.appendChild(a),e.appendChild(i),e.__resize_triggers__={triggers:i,expand:o,expandChild:s,contract:a},f(e),e.addEventListener("scroll",h,!0),e.__resize_last__={width:e.offsetWidth,height:e.offsetHeight}}(e),e.__resize_rendered__=o(e).rendered,window.MutationObserver){var x=new MutationObserver(e.__resize_mutation_handler__);x.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),e.__resize_mutation_observer__=x}e.__resize_listeners__.push(t),s++}function l(){var e=o(this),t=e.rendered,i=e.detached;t!==this.__resize_rendered__&&(!i&&this.__resize_triggers__&&(f(this),this.addEventListener("scroll",h,!0)),this.__resize_rendered__=t,c(this))}function h(){var e,n,r=this;f(this),this.__resize_raf__&&(e=this.__resize_raf__,i||(i=(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)}).bind(window)),i(e)),this.__resize_raf__=(n=function(){var e,t,i,n,o,s,a=(t=(e=r).__resize_last__,i=t.width,n=t.height,o=e.offsetWidth,s=e.offsetHeight,o!==i||s!==n?{width:o,height:s}:null);a&&(r.__resize_last__=a,c(r))},t||(t=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){return setTimeout(e,16)}).bind(window)),t(n))}function c(e){e&&e.__resize_listeners__&&e.__resize_listeners__.forEach((function(t){t.call(e)}))}function f(e){var t=e.__resize_triggers__,i=t.expand,n=t.expandChild,r=t.contract,o=r.scrollWidth,s=r.scrollHeight,a=i.offsetWidth,d=i.offsetHeight,l=i.scrollWidth,h=i.scrollHeight;r.scrollLeft=o,r.scrollTop=s,n.style.width=a+1+"px",n.style.height=d+1+"px",i.scrollLeft=l,i.scrollTop=h}var u,_;function p(e){e.$destroy(),u.removeChild(e.$el),_=null}function g(e){var t=e.node,i=e.maxLines,n=e.maxHeight,r=e.lineHeight;return!(!i&&!n)&&(!!(i&&function(e){var t=e.node,i=e.lineHeight;return i?Math.ceil(t.getClientRects()[0].height/i):Object.keys(Array.prototype.slice.call(t.getClientRects()).reduce((function(e,t){var i=t.top+"/"+t.bottom;return e[i]||(e[i]=!0),e}),{})).length}({node:t,lineHeight:r})>i)||!!(n&&t.offsetHeight>n))}function x(e){var t=e.nodes,i=e.nodesHolder,n=e.beforeNode,r=e.afterNode,o=e.maxLines,s=e.maxHeight,a=e.lineHeight,d=e.startLoc;void 0===d&&(d=0);var l=e.endLoc;void 0===l&&(l=t.length);var h=e.lastSuccessLoc;void 0===h&&(h=0);var c,f=Math.floor((d+l)/2),_=t.slice(0,f);c=i,u.removeChild(c);var p=m({tag:"div",beforeNode:n,afterNode:r}),v=p[0],b=p[1];_.forEach(b),u.appendChild(v);var y=function(){return!g({node:v,maxLines:o,maxHeight:s,lineHeight:a})};if(d>=l-1)for(var z=l;z>=d;z-=1){var N=t[z-1];if(b(N),y()||!N)return z===t.length?{offset:t.length}:{offset:z}}return y()?x({nodes:t,nodesHolder:v,beforeNode:n,afterNode:r,maxLines:o,maxHeight:s,lineHeight:a,startLoc:f,endLoc:l,lastSuccessLoc:f}):x({nodes:t,nodesHolder:v,beforeNode:n,afterNode:r,maxLines:o,maxHeight:s,lineHeight:a,startLoc:d,endLoc:f,lastSuccessLoc:h})}function m(e){var t=e.tag,i=e.beforeNode,n=e.ellipsis,r=e.afterNode,o=document.createElement(t),s=function(e){o.appendChild(e)};if(i&&o.appendChild(i),n){var a=document.createTextNode(n);o.appendChild(a),s=function(e){o.insertBefore(e,a)}}return r&&(o.appendChild(r),n||(s=function(e){o.insertBefore(e,r)})),[o,s]}function v(t){var i=t.before,n=t.text,r=t.nonTextNodes,o=t.after,s=t.ellipsis,a=t.maxLines,d=t.lineHeight,l=t.originEle,h={offset:n?n.length:r.length};if(n&&r&&r.length)return h;(u=document.createElement("div")).setAttribute("aria-hidden","true"),(_=document.createElement("div")).id="vue-inst",u.appendChild(_),document.body.appendChild(u);var c=window.getComputedStyle(l),f=function(e){return Array.prototype.slice.apply(e).map((function(t){return t+": "+e.getPropertyValue(t)+";"})).join("")}(c);u.setAttribute("style",f),u.style.position="fixed",u.style.left="0",u.style.height="auto",u.style.minHeight="auto",u.style.top="-999999px",u.style.zIndex="-1000",u.style.textOverflow="clip",u.style.whiteSpace="normal",u.style.webkitLineClamp="none";var v=function(t){var i=t.before,n=t.text,r=t.nonTextNodes,o=t.after,s=n||r;return new(e.extend({render:function(e){var t=[e("span",{},s)];return i&&t.unshift.apply(t,Array.isArray(i)?i:[i]),o&&t.push.apply(t,Array.isArray(o)?o:[o]),e(n?"span":"div",{domProps:{id:"contents"}},t)}}))}({before:i,text:n,nonTextNodes:r,after:o});v.$mount("#vue-inst");var b,y,z,N=c.maxHeight?(b=u,y=window.getComputedStyle(b),z=parseFloat(y.paddingTop)+parseFloat(y.paddingBottom),b.clientHeight-z):void 0;if(!g({node:document.getElementById("contents"),maxLines:a,maxHeight:N,lineHeight:d}))return p(v),document.body.removeChild(u),h;var H=null,T=[],L=null,w=Array.prototype.slice.apply(u.childNodes[0].childNodes).filter((function(e){return 8!==e.nodeType}));i?(H=w[0].cloneNode(!0),T=Array.prototype.slice.apply(w[1].cloneNode(!0).childNodes),o&&(L=w[2].cloneNode(!0))):(T=Array.prototype.slice.apply(w[0].cloneNode(!0).childNodes),o&&(L=w[1].cloneNode(!0))),p(v),u.innerHTML="";var C,E=m({tag:n?"span":"div",ellipsis:n?s:void 0,beforeNode:H,afterNode:L}),A=E[0],S=E[1];if(u.appendChild(A),n&&3===T[0].nodeType){var $=T[0].textContent||"",O=document.createTextNode($);S(O);var M=function e(t){var i=t.fullText,n=t.textNode,r=t.textHolder,o=t.maxLines,s=t.maxHeight,a=t.startLoc;void 0===a&&(a=0);var d=t.endLoc;void 0===d&&(d=i.length);var l=t.lastSuccessLoc;void 0===l&&(l=0);var h=Math.floor((a+d)/2),c=i.slice(0,h);n.textContent=c;var f=function(){return!g({node:r,maxLines:o,maxHeight:s})};if(a>=d-1)for(var u=d;u>=a;u-=1){var _=i.slice(0,u);if(n.textContent=_,f()||!_)return u===i.length?{offset:i.length}:{offset:_.length}}return f()?e({textNode:n,fullText:i,textHolder:r,maxLines:o,maxHeight:s,startLoc:h,endLoc:d,lastSuccessLoc:h}):e({textNode:n,fullText:i,textHolder:r,maxLines:o,maxHeight:s,startLoc:a,endLoc:h,lastSuccessLoc:l})}({fullText:$,textNode:O,textHolder:A,maxLines:a,maxHeight:N}).offset;"number"==typeof M&&(C=M)}else if(r.length){var F=T.filter((function(e){return 1===e.nodeType}));if(!F.length)return{offset:null};var k=x({nodes:F,nodesHolder:A,beforeNode:H,afterNode:L,maxLines:a,maxHeight:N,lineHeight:d}).offset;"number"==typeof k&&(C=k)}return document.body.removeChild(u),{offset:C}}var b,y=require("raf");return e.extend({name:"vue-clamp",props:{tag:{type:String,default:"div"},autoresize:{type:Boolean,default:!1},maxLines:Number,lineHeight:Number,maxHeight:[String,Number],ellipsis:{type:String,default:"â€¦"},expanded:Boolean},data:function(){return{offset:0,text:this.getText(),nonTextNodes:this.getNonTextNodes(),before:null,after:null,localExpanded:!!this.expanded}},computed:{clampedText:function(){return this.text.slice(0,this.offset)+this.ellipsis},clampedNonTextNodes:function(){return this.nonTextNodes.slice(0,this.offset)},isClamped:function(){return!(!this.text&&0===this.nonTextNodes.length)&&this.offset!==this.contentLength},realText:function(){return this.isClamped?this.clampedText:this.text},realNonTextNodes:function(){return this.isClamped?this.clampedNonTextNodes:this.nonTextNodes},realMaxHeight:function(){if(this.localExpanded)return null;var e=this.maxHeight;return e?"number"==typeof e?e+"px":e:null},contentLength:function(){return(this.text?this.text:this.nonTextNodes).length}},watch:{expanded:function(e){this.localExpanded=e},localExpanded:function(e){e?this.offset=this.contentLength:this.update(),this.expanded!==e&&this.$emit("update:expanded",e)},isClamped:{handler:function(e){var t=this;this.$nextTick((function(){return t.$emit("clampchange",e)})),this.updateBeforeAndAfter()},immediate:!0},before:function(e,t){e!==t&&this.update()},after:function(e,t){e!==t&&this.update()},text:function(e,t){e!==t&&(this.localExpanded=!1,this.update())},nonTextNodes:function(e,t){e.length!==t.length&&(this.localExpanded=!1,this.update())}},mounted:function(){var e=this;this.init(),this.$watch((function(e){return[e.tag,e.autoresize].join()}),(function(){e.init()}))},beforeUpdate:function(){this.updateBeforeAndAfter(),this.text=this.getText(),this.nonTextNodes=this.getNonTextNodes()},beforeDestroy:function(){this.cleanUp()},methods:{init:function(){var e=this;this.$slots.default&&(this.updateBeforeAndAfter(),this.text=this.getText(),this.nonTextNodes=this.getNonTextNodes(),this.localExpanded=!!this.expanded,this.offset=this.text?this.text.length:this.nonTextNodes.length,this.cleanUp(),this.autoresize&&(d(this.$el,this.resizeOnNextFrame),this.unregisterResizeCallback=function(){!function(e,t){if(e.detachEvent&&e.removeEventListener)return e.detachEvent("onresize",e.__resize_legacy_resize_handler__),void document.removeEventListener("DOMSubtreeModified",e.__resize_mutation_handler__);var i=e.__resize_listeners__;i&&(i.splice(i.indexOf(t),1),i.length||(e.__resize_observer__?(e.__resize_observer__.unobserve(e),e.__resize_observer__.disconnect(),e.__resize_observer__=null):(e.__resize_mutation_observer__&&(e.__resize_mutation_observer__.disconnect(),e.__resize_mutation_observer__=null),e.removeEventListener("scroll",h),e.removeChild(e.__resize_triggers__.triggers),e.__resize_triggers__=null),e.__resize_listeners__=null),!--s&&a&&a.parentNode.removeChild(a))}(e.$el,e.resizeOnNextFrame)}),this.$watch((function(e){return[e.maxLines,e.lineHeight,e.maxHeight,e.ellipsis].join()}),(function(){e.update()})),this.update())},update:function(){if(!this.localExpanded){var e=this.before,t=this.text,i=this.nonTextNodes,n=this.after,r=this.ellipsis,o=this.maxLines,s=this.lineHeight,a=v({before:e,text:t,nonTextNodes:i,after:n,ellipsis:r,maxLines:o,lineHeight:t?void 0:s,originEle:this.$refs.container}).offset;this.offset=a}},resizeOnNextFrame:function(){var e=this;y.cancel(b),b=y((function(){e.update()}))},expand:function(){this.localExpanded=!0},collapse:function(){this.localExpanded=!1},toggle:function(){this.localExpanded=!this.localExpanded},getText:function(){var e=(this.$slots.default||[]).filter((function(e){return!e.tag&&!e.isComment}))[0];return e?e.text:""},getNonTextNodes:function(){return(this.$slots.default||[]).filter((function(e){return e.tag&&!e.isComment}))},cleanUp:function(){b&&y.cancel(b),this.unregisterResizeCallback&&this.unregisterResizeCallback()},updateBeforeAndAfter:function(){var e={expand:this.expand,collapse:this.collapse,toggle:this.toggle,clamped:this.isClamped,expanded:this.localExpanded};this.before=this.$scopedSlots.before?this.$scopedSlots.before(e):this.$slots.before,this.after=this.$scopedSlots.after?this.$scopedSlots.after(e):this.$slots.after}},render:function(e){var t=this.text?this.text:this.nonTextNodes,i=this.text?this.realText:this.realNonTextNodes,n=[e("span",this.$isServer?{}:{attrs:{"aria-label":this.text?this.text.trim():""}},this.$isServer?t:i)];this.before&&n.unshift.apply(n,Array.isArray(this.before)?this.before:[this.before]),this.after&&n.push.apply(n,Array.isArray(this.after)?this.after:[this.after]);var r=[e("span",{style:{boxShadow:"transparent 0 0"}},n)];return e(this.tag,{style:{maxHeight:this.realMaxHeight,overflow:"hidden"},ref:"container"},r)}})}));
